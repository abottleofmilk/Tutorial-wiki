Canny边缘检测是一种使用多级边缘检测算法检测边缘的方法。1986年，John F.Canny发表了著名的论文A Computational Approach to Edge Detection，在该论文中详述了如何进行边缘检测。

## Canny边缘检测基础

1. 去噪。噪声会影响边缘检测的准确性，因此首先要将噪声过滤掉。
2. 计算梯度的幅度与方向。
3. 非极大值抑制，即适当地让边缘“变瘦”。
4. 确定边缘。使用双阈值算法确定最终的边缘信息。

### 应用高斯滤波去除图像噪声
由于图像边缘非常容易受到噪声的干扰，因此为了避免检测到错误的边缘信息，通常需要对图像进行滤波以去除噪声。滤波的目的是**平滑一些纹理较弱的非边缘区域**，以便得到更准确的边缘。在实际处理过程中，通常采用高斯滤波去除图像中的噪声。

![](https://s2.loli.net/2022/12/13/h3jo5LGYRXAJkTK.png)

滤波器的大小也是可变的，高斯核的大小对于边缘检测的效果具有很重要的作用。滤波器的核越大，边缘信息对于噪声的敏感度就越低。不过，核越大，边缘检测的定位错误也会随之增加。通常来说，一个5×5的核能够满足大多数的情况。

### 计算梯度
边缘检测算子返回水平方向的Gx和垂直方向的Gy。梯度的幅度G和方向Θ（用角度值表示）为：

![](https://s2.loli.net/2022/12/13/Z2QbeS8YBqPzLJW.png)

atan2(·)表示具有两个参数的arctan函数。梯度的方向总是与边缘垂直的，通常就近取值为水平（左、右）、垂直（上、下）、对角线（右上、左上、左下、右下）等8个不同的方向。


### 非极大值抑制
在获得了梯度的幅度和方向后，遍历图像中的像素点，去除所有非边缘的点。在具体实现时，逐一遍历像素点，判断当前像素点是否是周围像素点中具有相同梯度方向的最大值，并根据判断结果决定是否抑制该点。

该步骤是边缘细化的过程。针对每一个像素点：

+ 如果该点是正/负梯度方向上的局部最大值，则保留该点。
+ 如果不是，则抑制该点（归零）。

![](https://s2.loli.net/2022/12/14/Mxd89FWC2OPNQ6a.png)

A、B、C三点具有相同的方向（梯度方向垂直于边缘）。判断这三个点是否为各自的局部最大值：如果是，则保留该点；否则，抑制该点（归零）。经过比较判断可知，A点具有最大的局部值，所以保留A点（称为边缘），其余两点（B和C）被抑制（归零）。
### 应用双阈值确定边缘
图像内的强边缘已经在当前获取的边缘图像内。但是，一些虚边缘可能也在边缘图像内。这些虚边缘可能是真实图像产生的，也可能是由于噪声所产生的。对于后者，必须将其剔除。

设置两个阈值，其中一个为高阈值maxVal，另一个为低阈值minVal。根据当前边缘像素的梯度值（指的是梯度幅度，下同）与这两个阈值之间的关系，判断边缘的属性。具体步骤为：

1. 如果当前边缘像素的梯度值大于或等于maxVal，则将当前边缘像素标记为强边缘。
2. 如果当前边缘像素的梯度值介于maxVal与minVal之间，则将当前边缘像素标记为虚边缘（需要保留）。
3. 如果当前边缘像素的梯度值小于或等于minVal，则抑制当前边缘像素。